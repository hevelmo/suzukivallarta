$(document).ready(function(){function e(){var e,n,a;try{e=parseInt($("#map_canvas").attr("data-concessionaire-preselected-id")),isNaN(e)&&(e=16)}catch(i){e=0}e>0?(t=e,n=$("#map_canvas").attr("data-lat-lon").split(","),a=new google.maps.LatLng(n[0],n[1])):a=new google.maps.LatLng(20.6244,-103.421);var o={center:a,panControl:!IS_MOBILE,zoomControl:!IS_MOBILE,mapTypeControl:!1,streetViewControl:!IS_MOBILE,mapTypeId:google.maps.MapTypeId.ROADMAP,zoom:13};s=new google.maps.Map(document.getElementById("map_canvas"),o),c||$.get_map_data()}var n,s,a=[],i="/services/concessionaires",o=null,t=0,c=!1,r="",l=-1,d=!1;$.open_concessionaire_by_key=function(e,i){if(r!=e||!d||IS_MOBILE){$("html, body").animate({scrollTop:"0px"},400),r=e;for(var o,t=null,c=n.length;c--;)if(n[c].key==r){t=n[c],l=t.id;break}if(null==t)return $("#concessionaires-data").removeClass("active"),void 0;for(c=a.length;c--;)o=a[c],o.custom_data.key==r?o.select_me():o.reset_me();if(i)try{window.history.pushState(null,t.name,"/concesionarias/suzuki-"+e)}catch(p){}$("#concessionaires-data").addClass("active"),d=!0,$.adjust_map_width();var m=new google.maps.LatLng(t.lat,t.lon);s.setCenter(m),$("#concessionaires-dynamic-list li.concessionaire").removeClass("active"),$("#concessionaires-dynamic-list li.concessionaire").each(function(){if($(this).attr("data-key")==r){$(this).addClass("active");var e=$(".concessionaire-list").scrollTop(),n=$(this).offset().top-291+e;return $(".concessionaire-list").stop().delay(100).animate({scrollTop:n},600),!1}}),$("#concessionaire-title").text(t.name),$("#concessionaire-address").text(t.address),$("#concessionaire-zip").text(t.zip),$("#concessionaire-phone").text(t.phone),$("#concessionaire-phone").attr({href:"call:"+t.phone}),""!=t.website&&($("#concessionaire-website-wrapper").show(),$("#concessionaire-website").attr({href:t.website})),$("#concessionaire-image").attr({alt:t.name,src:"../images/sections/concessionaires/previews/"+t.key+"-big.jpg",title:t.name}),IS_MOBILE&&($("#concessionaires-list").hide(),$("#concessionaires-data").css({height:"auto",paddingTop:"130px"}))}},$.set_concessionaire_by_url=function(e){var n=e.split("/suzuki-");n.length>1&&$.open_concessionaire_by_key(n[1],!1)},$.get_map_data=function(){$.ajax({success:function(e){n=e.data;var i,t,c,r,l="http://"+location.host+"/images/sections/concessionaires/",p=l+"marker-regular.png";"Explorer"==BrowserDetect.browser&&Number(BrowserDetect.version)<9&&(p=l+"marker-regular-old-ie.png");var m={boxStyle:{background:"url('/images/sections/concessionaires/marker-active-bg.png') no-repeat",height:"67px",width:"250px"},closeBoxURL:"",content:"",disableAutoPan:!1,enableEventPropagation:!1,infoBoxClearance:new google.maps.Size(0,0),maxWidth:0,pane:"floatPane",pixelOffset:new google.maps.Size(-25,-71),zIndex:null};r="";for(i in n){c=n[i],r+='<option value="'+c.key+'">'+c.name+"</option>",t=new google.maps.LatLng(c.lat,c.lon);var h=new google.maps.Marker({custom_data:c,position:t,map:s,icon:p,reset_me:function(){},select_me:function(){null!=o&&o.close();var e='<div class="map-concessionaire-name"><span>'+this.custom_data.name+"</span></div>";m.content=e,o=new InfoBox(m),o.open(s,this)},shadow:l+"marker-shadow.png"});google.maps.event.addListener(h,"click",function(){$.open_concessionaire_by_key(this.custom_data.key,!0)}),a.push(h)}$("#concessionaire-select").html(r),$("#concessionaire-select").chosen(),$("#concessionaire-select").on("change",function(){var e=$(this).val();$.open_concessionaire_by_key(e,!0)}),$.set_concessionaire_by_url(window.location.pathname,!1),$("#concessionaires-dynamic-list li.concessionaire, #concessionaires-dynamic-list a").on("click",function(e){e.preventDefault(),$(this).is("a")||$.open_concessionaire_by_key($(this).attr("data-key"),!0)});try{window.addEventListener("popstate",function(){$.set_concessionaire_by_url(window.location.pathname)})}catch(_){}$("a.concessionaire-close").on("click",function(e){e.preventDefault(),$("#concessionaires-data").removeClass("active"),d=!1,$.adjust_map_width()})},url:i+"/all"})},$("#open-test-drive").on("click",function(e){e.preventDefault();var n={concessionaire_id:l,concessionaire_key:r,force_open:!0};"undefined"==typeof already_panel_open?$.openPanel("test-drive",n):($.scroll_to("top"),html=$.get_header_html("test-drive",n),data={html:html},div_html=Mustache.render(section_wrapper_template,data),$("#header-sections-wrapper").html(div_html),$.start_header_listeners("test-drive",n))}),IS_MOBILE&&($("#see-all").click(function(e){e.preventDefault(),$(".concessionaire-search").hide(),$(".concessionaire-list").fadeIn()}),$("#back-list-concessionaires").click(function(n){n.preventDefault(),t=0,c=!0,$("#concessionaires-data").css({height:"0",paddingTop:"0"}),$(".concessionaire-search").hide(),$("#concessionaires-list, .concessionaire-list").fadeIn(),$(".concessionaire").removeClass("active"),e()})),google.maps.event.addDomListener(window,"load",e),$.adjust_map_width=function(){$(".concessionaire-list").height($("#concessionaires-map").height()-196),$("#concessionaires-data .content").height($("#concessionaires-map").height());var e=$("#concessionaires-list").width()+1,n=0;$("#concessionaires-data").is(".active")&&($("#concessionaires-data:hidden").css({width:1}).show(),n=330);var s=$("#concessionaires").width(),a=s-e-n;$("#concessionaires-data").width(n),$("#concessionaires-map").width(a)},$(window).resize(function(){$.adjust_map_width()}),$(document).resize(function(){$.adjust_map_width()}),$.adjust_map_width()});